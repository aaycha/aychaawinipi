<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.gestion.ui.utilisateur.MonEspaceRestaurationController"
            prefWidth="1200" prefHeight="800">
    
    <top>
        <VBox styleClass="modern-header">
            <padding>
                <Insets top="20" right="24" bottom="20" left="24"/>
            </padding>
            <HBox alignment="CENTER_LEFT" spacing="16">
                <ImageView fitHeight="40" preserveRatio="true">
                    <image>
                        <Image url="@../images/lamma-logo.png" />
                    </image>
                </ImageView>
                <Label text="LAMMA - Mon Espace Restauration" styleClass="modern-title"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Label text="Espace utilisateur LAMMA" styleClass="role-label"/>
            </HBox>
        </VBox>
    </top>
    
    <center>
        <TabPane tabClosingPolicy="UNAVAILABLE" styleClass="modern-tab-pane">
            <Tab text="ðŸ½ï¸ Composer un plat">
                <ScrollPane fitToWidth="true" styleClass="modern-scroll-pane">
                    <VBox spacing="16" styleClass="modern-panel">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>
                        <Label text="Choisissez des composants pour crÃ©er votre plat" styleClass="section-title"/>
                        <Label text="SÃ©lectionnez des plats ou ingrÃ©dients dans la liste, ajoutez-les Ã  votre composition, donnez un nom Ã  votre plat puis enregistrez."
                               style="-fx-text-fill: #666; -fx-font-size: 13px;" wrapText="true"/>
                        <HBox spacing="16">
                            <VBox spacing="8" HBox.hgrow="ALWAYS">
                                <Label text="Composants disponibles" styleClass="section-subtitle"/>
                                <ListView fx:id="listeComposantsDispo" prefHeight="280" prefWidth="320" styleClass="modern-list"/>
                                <Button text="âž• Ajouter Ã  mon plat" onAction="#onAjouterComposant" styleClass="btn-success"/>
                            </VBox>
                            <VBox spacing="8" HBox.hgrow="ALWAYS">
                                <Label text="Ma composition (mon plat)" styleClass="section-subtitle"/>
                                <ListView fx:id="listeMaComposition" prefHeight="280" prefWidth="320" styleClass="modern-list"/>
                                <Button text="ðŸ—‘ï¸ Retirer de la composition" onAction="#onRetirerComposant" styleClass="btn-danger"/>
                            </VBox>
                        </HBox>
                        <Separator/>
                        <GridPane hgap="12" vgap="12">
                            <columnConstraints>
                                <ColumnConstraints minWidth="120" halignment="RIGHT"/>
                                <ColumnConstraints minWidth="280" hgrow="ALWAYS"/>
                            </columnConstraints>
                            <Label text="Nom de mon plat *" GridPane.columnIndex="0" GridPane.rowIndex="0" style="-fx-font-weight: bold;"/>
                            <VBox spacing="4" GridPane.columnIndex="1" GridPane.rowIndex="0">
                                <TextField fx:id="inputNomPlatCompose" promptText="Ex: Mon assiette personnalisÃ©e"
                                           style="-fx-padding: 10 14; -fx-font-size: 14px;"/>
                                <Label fx:id="errorNomPlatCompose" text="" visible="false" managed="false"
                                       style="-fx-text-fill: #e74c3c; -fx-font-size: 12px;"/>
                            </VBox>
                            <Label text="Type" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                            <ComboBox fx:id="comboTypePlatCompose" prefWidth="200" promptText="DEJEUNER, DINER..." GridPane.columnIndex="1" GridPane.rowIndex="1"/>
                        </GridPane>
                        <HBox spacing="12">
                            <Button text="ðŸ’¾ Enregistrer mon plat" onAction="#onEnregistrerPlatCompose" styleClass="btn-success"/>
                            <Button text="ðŸ”„ RÃ©initialiser" onAction="#onReinitialiserComposition" styleClass="btn-secondary"/>
                        </HBox>
                        <Label fx:id="messagePlatCompose" text="" wrapText="true"
                               style="-fx-text-fill: #27ae60; -fx-font-size: 13px;" visible="false" managed="false"/>
                    </VBox>
                </ScrollPane>
            </Tab>
            <Tab text="ðŸ“‹ Choisir un menu">
                <ScrollPane fitToWidth="true" styleClass="modern-scroll-pane">
                    <VBox spacing="16" styleClass="modern-panel">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>

                        <Label text="Choisir un menu : prendre un menu existant ou composer le vÃ´tre" styleClass="section-title"/>

                        <!-- Restrictions alimentaires -->
                        <VBox spacing="12" styleClass="form-section">
                            <Label text="Mes Restrictions Alimentaires" styleClass="section-subtitle"/>
                            <HBox spacing="16">
                                <CheckBox fx:id="checkVegetarien" text="VÃ©gÃ©tarien"/>
                                <CheckBox fx:id="checkVegan" text="VÃ©gan"/>
                                <CheckBox fx:id="checkSansGluten" text="Sans gluten"/>
                                <CheckBox fx:id="checkHalal" text="Halal"/>
                            </HBox>
                            <TextArea fx:id="inputAllergies" promptText="Listez vos allergies (sÃ©parÃ©es par des virgules)"
                                      wrapText="true" prefRowCount="2" styleClass="input-field"/>
                            <Button text="ðŸ’¾ Enregistrer mes restrictions" onAction="#onEnregistrerRestrictions" styleClass="btn-success"/>
                        </VBox>

                        <!-- GÃ©nÃ©ration automatique -->
                        <VBox spacing="12" styleClass="form-section">
                            <Label text="GÃ©nÃ©ration Automatique de Menu" styleClass="section-subtitle"/>
                            <HBox spacing="12">
                                <Label text="Ã‰vÃ©nement ID:"/>
                                <TextField fx:id="inputEvenementId" promptText="ID Ã©vÃ©nement" styleClass="input-field"/>
                                <Label text="Date:"/>
                                <DatePicker fx:id="inputDateMenu" styleClass="input-field"/>
                                <Button text="âœ¨ GÃ©nÃ©rer Menu" onAction="#onGenererMenu" styleClass="btn-primary"/>
                            </HBox>
                            <Label fx:id="menuGenereLabel" text="" wrapText="true" styleClass="info-label"/>
                        </VBox>

                        <!-- Choisir un menu : sÃ©lectionner un menu puis ajouter des repas -->
                        <VBox spacing="12" styleClass="form-section">
                            <Label text="SÃ©lectionner un menu puis ajouter des plats" styleClass="section-subtitle"/>
                            <HBox spacing="12">
                                <Label text="Menu :"/>
                                <ComboBox fx:id="comboMenu" prefWidth="220" promptText="Choisir un menu"/>
                                <Label text="Plat :"/>
                                <ComboBox fx:id="comboRepas" prefWidth="220" promptText="Choisir un plat Ã  ajouter"/>
                                <Button text="âž• Ajouter au menu" onAction="#onAjouterRepasAuMenu" styleClass="btn-success"/>
                            </HBox>

                            <Label text="Plats dans mon menu :" styleClass="section-subtitle"/>
                            <ListView fx:id="listeRepasMenu" prefHeight="200" styleClass="modern-list"/>
                            <HBox spacing="12">
                                <Button text="ðŸ”„ RÃ©organiser" onAction="#onReorganiser" styleClass="btn-secondary"/>
                                <Button text="ðŸ—‘ï¸ Supprimer sÃ©lectionnÃ©" onAction="#onSupprimerRepas" styleClass="btn-danger"/>
                                <Button text="ðŸ’¾ Enregistrer mon menu" onAction="#onEnregistrerMenu" styleClass="btn-success"/>
                            </HBox>
                        </VBox>

                        <!-- AperÃ§u menu -->
                        <VBox spacing="12" styleClass="form-section">
                            <Label text="AperÃ§u de Mon Menu" styleClass="section-subtitle"/>
                            <TextArea fx:id="apercuMenu" editable="false" wrapText="true" prefRowCount="5"
                                      styleClass="preview-area"/>
                            <Button text="ðŸ‘ï¸ PrÃ©visualiser" onAction="#onPrevisualiser" styleClass="btn-info"/>
                        </VBox>
                    </VBox>
                </ScrollPane>
            </Tab>
            <Tab text="ðŸ“… Mes Menus ComposÃ©s">
                <ScrollPane fitToWidth="true" styleClass="modern-scroll-pane">
                    <VBox spacing="16" styleClass="modern-panel">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>
                        <Label text="Mes Compositions de Menu" styleClass="section-title"/>
                        <Label text="Retrouvez ici l'historique de vos menus composÃ©s pour diffÃ©rents Ã©vÃ©nements." 
                               style="-fx-text-fill: #666; -fx-font-size: 13px;" wrapText="true"/>
                        
                        <VBox spacing="12" styleClass="form-section" VBox.vgrow="ALWAYS">
                            <ListView fx:id="listeMesCompositions" prefHeight="400" styleClass="modern-list"/>
                            <HBox spacing="12">
                                <Button text="ðŸ”„ Actualiser" onAction="#loadStatistics" styleClass="btn-info"/>
                                <Button text="ðŸ—‘ï¸ Supprimer l'historique" onAction="#onSupprimerHistoriqueMenu" styleClass="btn-danger"/>
                            </HBox>
                        </VBox>
                    </VBox>
                </ScrollPane>
            </Tab>
            <Tab text="ðŸ“Š Mes Statistiques">
                <ScrollPane fitToWidth="true" styleClass="modern-scroll-pane">
                    <VBox spacing="16" styleClass="modern-panel">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>
                        <Label text="Mes Statistiques Restauration" styleClass="section-title"/>
                        <GridPane hgap="12" vgap="12">
                            <columnConstraints>
                                <ColumnConstraints minWidth="200" prefWidth="300"/>
                                <ColumnConstraints minWidth="200" prefWidth="300"/>
                            </columnConstraints>
                            <Label text="Total repas crÃ©Ã©s:" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                            <Label fx:id="statTotalRepas" text="0" GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                            <Label text="Total dÃ©pensÃ©:" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                            <Label fx:id="statTotalDepense" text="0.00 â‚¬" GridPane.columnIndex="1" GridPane.rowIndex="1"/>
                            <Label text="Total calories:" GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                            <Label fx:id="statTotalCalories" text="0" GridPane.columnIndex="1" GridPane.rowIndex="2"/>
                            <Label text="Menus composÃ©s:" GridPane.columnIndex="0" GridPane.rowIndex="3"/>
                            <Label fx:id="statTotalMenus" text="0" GridPane.columnIndex="1" GridPane.rowIndex="3"/>
                        </GridPane>
                    </VBox>
                </ScrollPane>
            </Tab>
        </TabPane>
    </center>
</BorderPane>
