<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.Circle?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.image.Image?>

<BorderPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.gestion.ui.repas.RepasListeController"
            prefWidth="1300" prefHeight="900"
            stylesheets="@../../styles/restoration-2026.css"
            styleClass="modern-2026-root">

    <top>
        <VBox styleClass="admin-header">
            <padding>
                <Insets top="15" right="40" bottom="15" left="40"/>
            </padding>
            <HBox alignment="CENTER_LEFT" spacing="25">
                <!-- Duck Logo & Title -->
                <HBox spacing="15" alignment="CENTER_LEFT" styleClass="duck-logo">
                    <StackPane style="-fx-background-color: #CFFFEF; -fx-background-radius: 50%; -fx-padding: 8;">
                        <Label text="ðŸ¦†" style="-fx-font-size: 24px;"/>
                    </StackPane>
                    <VBox alignment="CENTER_LEFT">
                        <Label text="LAMMA Voyage" style="-fx-font-size: 24px; -fx-font-weight: 900; -fx-text-fill: white;"/>
                        <Label text="Gestion des Plats &amp; Repas" style="-fx-font-size: 11px; -fx-text-fill: #B2F2EA; -fx-font-weight: bold;"/>
                    </VBox>
                </HBox>
                
                <Region HBox.hgrow="ALWAYS"/>
                
                <!-- Admin Status & Toggle -->
                <HBox spacing="20" alignment="CENTER_LEFT">
                    <HBox spacing="10" alignment="CENTER_LEFT" styleClass="glass-panel" style="-fx-padding: 5 15; -fx-background-radius: 25;">
                        <Label text="Espace :" style="-fx-text-fill: white; -fx-font-size: 13px;"/>
                        <ComboBox fx:id="spaceSelector" promptText="Administrateur" style="-fx-background-color: transparent;"/>
                    </HBox>
                    
                    <HBox spacing="10" alignment="CENTER_LEFT" styleClass="badge-lavender">
                        <Label text="Admin IA Assist" style="-fx-font-size: 12px;"/>
                        <ToggleButton fx:id="iaToggle" selected="true" styleClass="btn-ai-assist" text="ON"/>
                    </HBox>
                    
                    <Circle fx:id="userAvatar" radius="20" fill="#E0E7FF" stroke="white" strokeWidth="2"/>
                </HBox>
            </HBox>
        </VBox>
    </top>

    <center>
        <ScrollPane fitToWidth="true" hbarPolicy="NEVER" vbarPolicy="AS_NEEDED" style="-fx-background-color: transparent;">
            <VBox spacing="25" style="-fx-background-color: transparent;">
                <padding>
                    <Insets top="30" right="40" bottom="30" left="40"/>
                </padding>
    
                <!-- ACTION BAR 2.0 -->
                <HBox spacing="12" alignment="CENTER_LEFT" styleClass="glass-panel" style="-fx-padding: 15; -fx-background-radius: 24;">
                    <Button text="+ Nouveau..." onAction="#onNouveauRepas" styleClass="btn-turquoise" style="-fx-font-size: 14px;"/>
                    <Button text="âŠ• Actu..." onAction="#onActualiser" styleClass="btn-primary" style="-fx-background-radius: 20; -fx-background-color: #3B82F6; -fx-text-fill: white; -fx-padding: 10 20;"/>
                    
                    <MenuButton text="â†‘ Exporter..." styleClass="badge-mint" style="-fx-background-color: #CFFFEF; -fx-padding: 8 15; -fx-background-radius: 20;">
                        <items>
                            <MenuItem text="Format JSON" />
                            <MenuItem text="Format CSV" />
                            <MenuItem text="Format PDF" onAction="#onExportPDF" />
                        </items>
                    </MenuButton>
                    
                    <Button text="Importer Plats" styleClass="badge-lavender" style="-fx-background-radius: 20; -fx-padding: 8 15;"/>
                    
                    <Region HBox.hgrow="ALWAYS"/>
                    
                    <!-- Smart Search -->
                    <HBox alignment="CENTER_LEFT" spacing="10" styleClass="search-bar-smart" prefWidth="400">
                        <Label text="ðŸ”" style="-fx-font-size: 16px;"/>
                        <TextField fx:id="searchField" promptText="Rechercher par nom, ingrÃ©dient, tendance..."
                                   style="-fx-background-color: transparent; -fx-padding: 0;"/>
                    </HBox>
                </HBox>
    
                <!-- SMART FILTERS BAR (Sticky-like) -->
                <HBox spacing="12" alignment="CENTER_LEFT" styleClass="glass-panel" style="-fx-padding: 12 20; -fx-background-radius: 24;">
                    <Label text="FILTRES IA" style="-fx-font-weight: 900; -fx-text-fill: #1E3A8A; -fx-font-size: 11px;"/>
                    <ComboBox fx:id="filterRestaurantCombo" promptText="Restaurants" prefWidth="160" styleClass="modern-combo"/>
                    <ComboBox fx:id="filterMenuCombo" promptText="Menus" prefWidth="130" styleClass="modern-combo"/>
                    <ComboBox fx:id="filterCategorieCombo" promptText="CatÃ©gorie" prefWidth="120" styleClass="modern-combo"/>
                    <ComboBox fx:id="filterTypePlatCombo" promptText="Type" prefWidth="100" styleClass="modern-combo"/>
                    <ComboBox fx:id="filterDisponibleCombo" promptText="Statut" prefWidth="120" styleClass="modern-combo"/>
                    
                    <Separator orientation="VERTICAL" prefHeight="24" style="-fx-opacity: 0.2;"/>
                    
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Label text="TENDANCES" style="-fx-font-weight: 900; -fx-font-size: 9px; -fx-text-fill: #6366F1;"/>
                        <Label text="VÃ‰GAN" styleClass="health-badge" style="-fx-background-color: #CFFFEF; -fx-text-fill: #00D4B4;"/>
                        <Label text="HALAL" styleClass="health-badge" style="-fx-background-color: #FEF9C3; -fx-text-fill: #854D0E;"/>
                        <Label fx:id="countLabel" text="4 plats" styleClass="badge-mint" style="-fx-font-size: 10px;"/>
                    </HBox>
    
                    <Region HBox.hgrow="ALWAYS"/>
                    <Button text="RÃ©initialiser" onAction="#onReinitialiserFiltres" style="-fx-text-fill: #EF4444; -fx-background-color: transparent; -fx-font-size: 11px; -fx-font-weight: bold;"/>
                </HBox>
    
                <!-- CORE 60/40 SPLIT -->
                <GridPane hgap="30" VBox.vgrow="ALWAYS">
                    <columnConstraints>
                        <ColumnConstraints percentWidth="60"/>
                        <ColumnConstraints percentWidth="40"/>
                    </columnConstraints>
                    
                    <!-- Left: Catalogue -->
                    <VBox GridPane.columnIndex="0" spacing="20" styleClass="glass-panel" style="-fx-padding: 25; -fx-background-radius: 32; -fx-background-color: rgba(255,255,255,0.6);">
                        <HBox alignment="CENTER_LEFT">
                            <Label text="Catalogue des Plats" style="-fx-font-weight: 900; -fx-font-size: 24px; -fx-text-fill: #1E3A8A;"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <ComboBox fx:id="sortCombo" promptText="Trier par..." prefWidth="150" style="-fx-background-radius: 15;"/>
                        </HBox>
                        <ListView fx:id="listView" VBox.vgrow="ALWAYS" minHeight="500" styleClass="modern-list-view" onMouseClicked="#onListClick"/>
                    </VBox>
                    
                    <!-- Right: Preview & Insights -->
                    <VBox GridPane.columnIndex="1" spacing="25">
                        <!-- Preview Section -->
                        <VBox fx:id="previewSidebar" spacing="20" styleClass="glass-panel" style="-fx-padding: 30; -fx-background-radius: 32; -fx-background-color: rgba(255,255,255,0.8);">
                            <Label text="PREVIEW LIVE" style="-fx-font-weight: 900; -fx-font-size: 16px; -fx-text-fill: #1E3A8A;"/>
                            <VBox fx:id="previewContainer" alignment="TOP_CENTER" spacing="20" style="-fx-background-color: white; -fx-background-radius: 24; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.05), 20, 0, 0, 5); -fx-padding: 25;">
                                <StackPane fx:id="imageContainer" prefHeight="220" style="-fx-background-color: #F8FAFC; -fx-background-radius: 20;">
                                    <Label text="ðŸ½ï¸" style="-fx-font-size: 64px; -fx-opacity: 0.2;"/>
                                    <ImageView fx:id="previewImage" fitHeight="220" fitWidth="300" preserveRatio="true"/>
                                </StackPane>
                                
                                <VBox spacing="10" alignment="CENTER">
                                    <Label fx:id="previewName" text="SÃ©lectionnez un plat" textAlignment="CENTER" wrapText="true" style="-fx-font-weight: 900; -fx-font-size: 22px; -fx-text-fill: #1E3A8A;"/>
                                    <Label fx:id="previewCategory" text="CatÃ©gorie" styleClass="badge-mint"/>
                                </VBox>
                                
                                <HBox alignment="CENTER" spacing="30">
                                    <VBox alignment="CENTER">
                                        <Label text="PRIX" style="-fx-font-size: 10px; -fx-text-fill: #64748B; -fx-font-weight: 900;"/>
                                        <Label fx:id="previewPrice" text="0.00 â‚¬" style="-fx-font-weight: 900; -fx-font-size: 24px; -fx-text-fill: #00D4B4;"/>
                                    </VBox>
                                    <VBox alignment="CENTER">
                                        <Label text="STATUT" style="-fx-font-size: 10px; -fx-text-fill: #64748B; -fx-font-weight: 900;"/>
                                        <Label fx:id="previewStatus" text="-" style="-fx-font-weight: bold; -fx-font-size: 14px;"/>
                                    </VBox>
                                </HBox>
                                
                                <Label fx:id="previewDescription" text="L'IA analysera les dÃ©tails du plat aprÃ¨s sÃ©lection." wrapText="true" style="-fx-text-fill: #64748B; -fx-font-size: 13px;" textAlignment="CENTER"/>
                                
                                <HBox spacing="15" alignment="CENTER">
                                    <Button fx:id="btnModifier" text="Ã‰diter" onAction="#onModifier" disable="true" styleClass="btn-turquoise" prefWidth="120"/>
                                    <Button fx:id="btnSupprimer" text="Supprimer" onAction="#onSupprimer" disable="true" style="-fx-background-color: #FEE2E2; -fx-text-fill: #EF4444; -fx-background-radius: 20; -fx-padding: 10 20; -fx-font-weight: bold;" prefWidth="120"/>
                                </HBox>
                            </VBox>
                        </VBox>
                        
                        <!-- Insights Section -->
                        <VBox spacing="15" styleClass="glass-panel" style="-fx-padding: 25; -fx-background-radius: 32; -fx-background-color: rgba(224, 187, 228, 0.2);">
                            <HBox alignment="CENTER_LEFT">
                                <Label text="Insights IA" style="-fx-font-weight: 900; -fx-font-size: 16px; -fx-text-fill: #6A1B9A;"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Label text="âœ¨" style="-fx-font-size: 18px;"/>
                            </HBox>
                            <VBox spacing="8" style="-fx-padding: 10;">
                                <Label text="ðŸ“ˆ PopularitÃ© en hausse (+12%)" style="-fx-font-size: 12px; -fx-text-fill: #1E3A8A; -fx-font-weight: bold;"/>
                                <Label text="ðŸ’¡ Conseil : Ajoutez des photos plus lumineuses pour ce plat." wrapText="true" style="-fx-font-size: 11px; -fx-text-fill: #64748B;"/>
                            </VBox>
                        </VBox>
                    </VBox>
                </GridPane>
            </VBox>
        </ScrollPane>
    </center>

    <bottom>
        <HBox alignment="CENTER_LEFT" styleClass="sticky-footer">
            <Label fx:id="statusLabel" text="Version 2026 Stable â€¢ LAMMA Voyager Assist Online" style="-fx-text-fill: #64748B; -fx-font-size: 12px; -fx-font-weight: bold;"/>
            <Region HBox.hgrow="ALWAYS"/>
            <HBox spacing="10" alignment="CENTER_LEFT">
                <Circle radius="5" fill="#00D4B4"/>
                <Label text="API Cloud ConnectÃ©e" style="-fx-font-size: 12px; -fx-text-fill: #00D4B4; -fx-font-weight: 900;"/>
            </HBox>
        </HBox>
    </bottom>
</BorderPane>
