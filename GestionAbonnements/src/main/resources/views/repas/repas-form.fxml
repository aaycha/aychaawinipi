<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<ScrollPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.gestion.ui.repas.RepasFormController"
            fitToWidth="true"
            style="-fx-background-color: transparent;">

    <VBox spacing="30" style="-fx-background-color: transparent;" prefWidth="1000" maxWidth="1000">
        <padding>
            <Insets top="40" right="60" bottom="40" left="60"/>
        </padding>

        <!-- Header 2026 -->
        <HBox spacing="20" alignment="CENTER_LEFT" style="-fx-background-color: rgba(30, 58, 138, 0.9); -fx-background-radius: 24; -fx-padding: 20 30;">
            <StackPane style="-fx-background-color: #CFFFEF; -fx-background-radius: 50%; -fx-padding: 10;">
                <Label text="ðŸ¦†" style="-fx-font-size: 32px;"/>
            </StackPane>
            <VBox spacing="5" HBox.hgrow="ALWAYS">
                <Label fx:id="formTitle" text="Nouveau Plat" style="-fx-font-size: 32px; -fx-font-weight: 900; -fx-text-fill: white;"/>
                <Label text="Assistant IA LAMMA Voyage v2.0 â€¢ Optimisation du menu" style="-fx-font-size: 13px; -fx-text-fill: #B2F2EA; -fx-font-weight: bold;"/>
            </VBox>
            <ToggleButton fx:id="iaToggleInForm" selected="true" text="IA ACTIVE" styleClass="btn-ai-assist" style="-fx-background-color: #00D4B4; -fx-text-fill: white; -fx-font-size: 11px;"/>
        </HBox>

        <GridPane hgap="30" vgap="0">
            <columnConstraints>
                <ColumnConstraints percentWidth="65"/>
                <ColumnConstraints percentWidth="35"/>
            </columnConstraints>

            <!-- LEFT: CORE FORM -->
            <VBox GridPane.columnIndex="0" spacing="25">
                <!-- Error Container -->
                <VBox fx:id="errorContainer" visible="false" managed="false" style="-fx-background-color: #FEE2E2; -fx-background-radius: 20; -fx-padding: 20; -fx-border-color: #EF4444; -fx-border-width: 1; -fx-border-radius: 20;">
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Label text="âš ï¸" style="-fx-font-size: 16px;"/>
                        <Label fx:id="globalErrorMessage" text="Veuillez corriger les erreurs avant d'enregistrer." style="-fx-text-fill: #B91C1C; -fx-font-weight: 900; -fx-font-size: 13px;"/>
                    </HBox>
                </VBox>

                <VBox spacing="25" style="-fx-background-color: rgba(255,255,255,0.9); -fx-background-radius: 32; -fx-padding: 35; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.05), 20, 0, 0, 8);">
                    
                    <!-- Section: IdentitÃ© -->
                    <VBox spacing="15">
                        <Label text="IDENTITÃ‰ DU PLAT" style="-fx-font-weight: 900; -fx-text-fill: #1E3A8A; -fx-font-size: 12px;"/>
                        <VBox spacing="8">
                            <TextField fx:id="inputNom" promptText="Nom du plat..." styleClass="search-bar-smart" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                            <HBox spacing="10">
                                <ComboBox fx:id="comboRestaurant" promptText="Restaurant" HBox.hgrow="ALWAYS" maxWidth="Infinity" styleClass="modern-combo"/>
                                <ComboBox fx:id="comboMenu" promptText="Menu" HBox.hgrow="ALWAYS" maxWidth="Infinity" styleClass="modern-combo"/>
                            </HBox>
                        </VBox>
                    </VBox>

                    <!-- Section: CaractÃ©ristiques -->
                    <HBox spacing="20">
                        <VBox spacing="10" HBox.hgrow="ALWAYS">
                            <Label text="CLASSIFICATION" style="-fx-font-weight: 900; -fx-text-fill: #1E3A8A; -fx-font-size: 11px;"/>
                            <ComboBox fx:id="comboCategorie" promptText="CatÃ©gorie" maxWidth="Infinity" styleClass="modern-combo"/>
                            <ComboBox fx:id="comboTypePlat" promptText="Type de plat" maxWidth="Infinity" styleClass="modern-combo"/>
                        </VBox>
                        <VBox spacing="10" HBox.hgrow="ALWAYS">
                            <Label text="METRICS" style="-fx-font-weight: 900; -fx-text-fill: #1E3A8A; -fx-font-size: 11px;"/>
                            <TextField fx:id="inputPrix" promptText="Prix (â‚¬)" styleClass="modern-combo"/>
                            <TextField fx:id="inputTempsPreparation" promptText="Temps prÃ©pa (min)" styleClass="modern-combo"/>
                        </VBox>
                    </HBox>

                    <!-- Section: IA Content Generation -->
                    <VBox spacing="15" style="-fx-background-color: rgba(224, 187, 228, 0.1); -fx-padding: 20; -fx-background-radius: 24; -fx-border-color: #E0BBE4; -fx-border-width: 1; -fx-border-style: dashed;">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="CONTENU GÃ‰NÃ‰RÃ‰ PAR IA" style="-fx-font-weight: 900; -fx-text-fill: #6A1B9A; -fx-font-size: 11px;"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="âœ¨ GÃ©nÃ©rer via IA" onAction="#onIAGenerate" styleClass="badge-lavender" style="-fx-cursor: hand;"/>
                        </HBox>
                        
                        <VBox spacing="10">
                            <TextArea fx:id="inputDescription" promptText="L'IA peut rÃ©diger une description allÃ©chante pour vous..." wrapText="true" prefRowCount="4" style="-fx-background-radius: 12; -fx-border-radius: 12;"/>
                            
                            <!-- Allergen Zone -->
                            <HBox fx:id="allergenBox" spacing="8" alignment="CENTER_LEFT" managed="false" visible="false">
                                <Label text="AllergÃ¨nes dÃ©tectÃ©s :" style="-fx-font-size: 11px; -fx-text-fill: #64748B;"/>
                                <!-- Badges dynamically added in controller -->
                            </HBox>
                        </VBox>
                    </VBox>

                    <!-- Image & Status -->
                    <HBox spacing="20" alignment="BOTTOM_LEFT">
                        <VBox spacing="10" HBox.hgrow="ALWAYS">
                            <Label text="VISUEL DU PLAT" style="-fx-font-weight: 900; -fx-text-fill: #1E3A8A; -fx-font-size: 11px;"/>
                            <HBox spacing="10">
                                <TextField fx:id="inputImageUrl" promptText="URL ou chemin..." HBox.hgrow="ALWAYS" styleClass="modern-combo"/>
                                <Button text="ðŸ“" onAction="#onUploadImage" styleClass="btn-turquoise" style="-fx-padding: 8 15;"/>
                            </HBox>
                        </VBox>
                        <CheckBox fx:id="checkDisponible" text="EN LIGNE" selected="true" style="-fx-font-weight: 900; -fx-text-fill: #00D4B4;"/>
                    </HBox>
                </VBox>
                
                <!-- Action Buttons -->
                <HBox spacing="15" alignment="CENTER_LEFT">
                    <Button text="SAUVEGARDER LE PLAT" onAction="#onEnregistrer" styleClass="btn-turquoise" prefWidth="250" prefHeight="50"/>
                    <Button text="ANNULER" onAction="#onAnnuler" style="-fx-background-color: rgba(255,255,255,0.5); -fx-text-fill: #EF4444; -fx-font-weight: 900; -fx-background-radius: 25; -fx-padding: 10 30;"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Label fx:id="statusMessage" text="En attente de saisie..." style="-fx-text-fill: #64748B; -fx-font-size: 11px;"/>
                </HBox>
            </VBox>

            <!-- RIGHT: IA SUGGESTIONS & TRENDS -->
            <VBox GridPane.columnIndex="1" spacing="25">
                <VBox spacing="20" styleClass="glass-panel" style="-fx-padding: 30; -fx-background-radius: 32; -fx-background-color: rgba(30, 58, 138, 0.05);">
                    <Label text="IA SUGGESTIONS" style="-fx-font-weight: 900; -fx-font-size: 14px; -fx-text-fill: #1E3A8A;"/>
                    
                    <VBox spacing="15">
                        <Label text="TENDANCES VOYAGE ACTIVÃ‰ES" style="-fx-font-size: 10px; -fx-text-fill: #64748B; -fx-font-weight: bold;"/>
                        
                        <VBox spacing="10">
                            <!-- Trend Card 1 -->
                            <VBox spacing="5" onMouseClicked="#onTrendPokeBowl" style="-fx-background-color: white; -fx-background-radius: 15; -fx-padding: 12; -fx-cursor: hand; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.03), 10, 0, 0, 2);">
                                <HBox alignment="CENTER_LEFT">
                                    <Label text="ðŸ¥— Poke Bowl" style="-fx-font-weight: 900; -fx-font-size: 13px;"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Label text="+22%" style="-fx-text-fill: #059669; -fx-font-size: 10px; -fx-font-weight: bold;"/>
                                </HBox>
                                <Label text="Boostez vos ventes avec une option saine" style="-fx-font-size: 11px; -fx-text-fill: #94A3B8;" wrapText="true"/>
                            </VBox>

                            <!-- Trend Card 2 -->
                            <VBox spacing="5" onMouseClicked="#onTrendTaco" style="-fx-background-color: white; -fx-background-radius: 15; -fx-padding: 12; -fx-cursor: hand; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.03), 10, 0, 0, 2);">
                                <HBox alignment="CENTER_LEFT">
                                    <Label text="ðŸŒ® Street Taco" style="-fx-font-weight: 900; -fx-font-size: 13px;"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Label text="+15%" style="-fx-text-fill: #059669; -fx-font-size: 10px; -fx-font-weight: bold;"/>
                                </HBox>
                                <Label text="IdÃ©al pour les menus logistique/rapide" style="-fx-font-size: 11px; -fx-text-fill: #94A3B8;" wrapText="true"/>
                            </VBox>
                        </VBox>
                    </VBox>
                    
                    <Separator style="-fx-opacity: 0.1;"/>
                    
                    <VBox spacing="12">
                        <Label text="LIVE INSIGHTS" style="-fx-font-weight: 900; -fx-font-size: 11px; -fx-text-fill: #1E3A8A;"/>
                        <Label fx:id="iaInsightLabel" text="Saisissez un nom pour analyser le marchÃ© local." wrapText="true" style="-fx-font-size: 11px; -fx-text-fill: #64748B;"/>
                    </VBox>
                </VBox>

                <!-- Nutrition Mock Card -->
                <VBox spacing="15" style="-fx-background-color: #CFFFEF; -fx-background-radius: 32; -fx-padding: 25;">
                    <Label text="VALEURS NUTRI (MOCK)" style="-fx-font-weight: 900; -fx-font-size: 11px; -fx-text-fill: #00897B;"/>
                    <GridPane hgap="10" vgap="10">
                        <VBox GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="CALORIES" style="-fx-font-size: 9px;"/>
                            <Label fx:id="mockCalories" text="--" style="-fx-font-weight: 900; -fx-font-size: 16px;"/>
                        </VBox>
                        <VBox GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="PROTÃ‰INES" style="-fx-font-size: 9px;"/>
                            <Label fx:id="mockProteins" text="--" style="-fx-font-weight: 900; -fx-font-size: 16px;"/>
                        </VBox>
                    </GridPane>
                </VBox>
            </VBox>
        </GridPane>
    </VBox>
</ScrollPane>
