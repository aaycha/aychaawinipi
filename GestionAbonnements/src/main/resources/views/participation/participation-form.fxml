<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>

<VBox xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.gestion.ui.participation.ParticipationFormController"
      spacing="16" styleClass="modern-panel" prefWidth="660" maxWidth="700">

    <padding>
        <Insets top="20" right="20" bottom="20" left="20"/>
    </padding>

    <!-- ══ Titre ══════════════════════════════════════════════════════ -->
    <Label fx:id="formTitle" text="Nouvelle participation"
           style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #1a3c5e;"/>

    <Separator/>

    <!-- ══ Infos principales ══════════════════════════════════════════ -->
    <TitledPane text="Informations principales" expanded="true" collapsible="false"
                style="-fx-font-weight: bold;">
        <content>
            <GridPane hgap="12" vgap="10">
                <padding><Insets top="8" right="4" bottom="8" left="4"/></padding>
                <columnConstraints>
                    <ColumnConstraints minWidth="130" prefWidth="150"/>
                    <ColumnConstraints minWidth="160" prefWidth="200" hgrow="ALWAYS"/>
                    <ColumnConstraints minWidth="130" prefWidth="150"/>
                    <ColumnConstraints minWidth="160" prefWidth="200" hgrow="ALWAYS"/>
                </columnConstraints>

                <!-- Ligne 0 : User ID / Événement ID -->
                <Label text="User ID *:" GridPane.columnIndex="0" GridPane.rowIndex="0"
                       style="-fx-font-weight: bold;"/>
                <TextField fx:id="inputUserId" promptText="ex: 1"
                           GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                <Label text="Événement ID *:" GridPane.columnIndex="2" GridPane.rowIndex="0"
                       style="-fx-font-weight: bold;"/>
                <TextField fx:id="inputEvenementId" promptText="ex: 2"
                           GridPane.columnIndex="3" GridPane.rowIndex="0"/>

                <!-- Ligne 1 : Type / Contexte -->
                <Label text="Type *:" GridPane.columnIndex="0" GridPane.rowIndex="1"
                       style="-fx-font-weight: bold;"/>
                <ComboBox fx:id="inputType" prefWidth="200"
                          GridPane.columnIndex="1" GridPane.rowIndex="1"/>

                <Label text="Contexte social *:" GridPane.columnIndex="2" GridPane.rowIndex="1"
                       style="-fx-font-weight: bold;"/>
                <ComboBox fx:id="inputContexte" prefWidth="200"
                          GridPane.columnIndex="3" GridPane.rowIndex="1"/>

                <!-- Ligne 2 : Hébergement -->
                <Label text="Hébergement:" GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                <CheckBox fx:id="inputHebergement" text="Avec hébergement"
                          GridPane.columnIndex="1" GridPane.rowIndex="2"/>

                <Label text="Nombre de nuits:" GridPane.columnIndex="2" GridPane.rowIndex="2"/>
                <TextField fx:id="inputHebergementNuits" promptText="0"
                           GridPane.columnIndex="3" GridPane.rowIndex="2"/>
            </GridPane>
        </content>
    </TitledPane>

    <!-- ══ Composition du groupe ══════════════════════════════════════ -->
    <TitledPane text="Composition du groupe" expanded="true" collapsible="false"
                style="-fx-font-weight: bold;">
        <content>
            <VBox spacing="10">
                <padding><Insets top="8" right="4" bottom="8" left="4"/></padding>

                <GridPane hgap="12" vgap="10">
                    <columnConstraints>
                        <ColumnConstraints minWidth="130" prefWidth="150"/>
                        <ColumnConstraints minWidth="100" prefWidth="120"/>
                        <ColumnConstraints minWidth="130" prefWidth="150"/>
                        <ColumnConstraints minWidth="100" prefWidth="120"/>
                    </columnConstraints>

                    <!-- Adultes -->
                    <Label text="Adultes * (≥ 1):" GridPane.columnIndex="0" GridPane.rowIndex="0"
                           style="-fx-font-weight: bold;"/>
                    <TextField fx:id="inputNbAdultes" promptText="1"
                               GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                    <!-- Enfants -->
                    <Label text="Enfants (0-8):" GridPane.columnIndex="2" GridPane.rowIndex="0"/>
                    <TextField fx:id="inputNbEnfants" promptText="0"
                               GridPane.columnIndex="3" GridPane.rowIndex="0"/>

                    <!-- Chiens -->
                    <Label text="Chiens (0-3):" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                    <TextField fx:id="inputNbChiens" promptText="0"
                               GridPane.columnIndex="1" GridPane.rowIndex="1"/>

                    <!-- Total -->
                    <Label fx:id="labelTotalParticipants" text="Total participants : 1"
                           GridPane.columnIndex="2" GridPane.rowIndex="1" GridPane.columnSpan="2"
                           style="-fx-font-weight: bold; -fx-text-fill: #1a3c5e;"/>
                </GridPane>

                <!-- Aide visuelle -->
                <Label text="ℹ  1 adulte + enfant(s) → Pass Famille (60 €) | Adulte seul → Journée (25 €/adulte) | Chien → +8 €/chien"
                       style="-fx-font-size: 11px; -fx-text-fill: #666; -fx-wrap-text: true;"/>
            </VBox>
        </content>
    </TitledPane>

    <!-- ══ Tarification calculée (lecture seule) ══════════════════════ -->
    <TitledPane text="Tarification calculée automatiquement" expanded="true" collapsible="false"
                style="-fx-font-weight: bold;">
        <content>
            <GridPane hgap="12" vgap="8">
                <padding><Insets top="8" right="4" bottom="8" left="4"/></padding>
                <columnConstraints>
                    <ColumnConstraints minWidth="160" prefWidth="180"/>
                    <ColumnConstraints minWidth="200" prefWidth="240" hgrow="ALWAYS"/>
                </columnConstraints>

                <Label text="Type d'abonnement :" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                <Label fx:id="labelTypeAbonnement" text="journee"
                       GridPane.columnIndex="1" GridPane.rowIndex="0"
                       style="-fx-font-weight: bold; -fx-text-fill: #1890ff;"/>

                <Label text="Montant estimé (€) :" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                <Label fx:id="labelMontant" text="25.00"
                       GridPane.columnIndex="1" GridPane.rowIndex="1"
                       style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: #28a745;"/>
            </GridPane>
        </content>
    </TitledPane>

    <!-- ══ Commentaires et besoins speciaux ══════════════════════════ -->
    <TitledPane text="Commentaires et besoins speciaux" expanded="false"
                style="-fx-font-weight: bold;">
        <content>
            <GridPane hgap="12" vgap="8">
                <padding><Insets top="8" right="4" bottom="8" left="4"/></padding>
                <columnConstraints>
                    <ColumnConstraints minWidth="130" prefWidth="150"/>
                    <ColumnConstraints minWidth="280" prefWidth="340" hgrow="ALWAYS"/>
                </columnConstraints>

                <Label text="Commentaire:" GridPane.columnIndex="0" GridPane.rowIndex="0"
                       GridPane.valignment="TOP"/>
                <TextArea fx:id="inputCommentaire" prefRowCount="2"
                          promptText="Ex: Enfants de 9 et 11 ans, chien berger australien tenu en laisse..."
                          wrapText="true"
                          GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                <Label text="Besoins speciaux:" GridPane.columnIndex="0" GridPane.rowIndex="1"
                       GridPane.valignment="TOP"/>
                <TextArea fx:id="inputBesoinsSpeciaux" prefRowCount="2"
                          promptText="Ex: Allergie aux arachides, besoin siege auto enfant..."
                          wrapText="true"
                          GridPane.columnIndex="1" GridPane.rowIndex="1"/>
            </GridPane>
        </content>
    </TitledPane>

    <!-- ══ Messages de validation ════════════════════════════════════ -->
    <VBox spacing="4">
        <Label fx:id="errorUserId"
               style="-fx-text-fill: #dc3545; -fx-font-size: 11px;"
               visible="false" managed="false" wrapText="true"/>
        <Label fx:id="errorEvenementId"
               style="-fx-text-fill: #dc3545; -fx-font-size: 11px;"
               visible="false" managed="false" wrapText="true"/>
        <Label fx:id="errorGroupe"
               style="-fx-text-fill: #dc3545; -fx-font-size: 11px;"
               visible="false" managed="false" wrapText="true"/>
        <Label fx:id="errorGlobal"
               style="-fx-text-fill: #dc3545; -fx-font-weight: bold; -fx-font-size: 12px;"
               visible="false" managed="false" wrapText="true"/>
    </VBox>

    <Separator/>

    <!-- ══ Boutons ════════════════════════════════════════════════════ -->
    <HBox spacing="12" alignment="CENTER_RIGHT">
        <Button text="Annuler" onAction="#onAnnuler"
                style="-fx-background-color: #6c757d; -fx-text-fill: white; -fx-cursor: hand; -fx-padding: 8 20;"/>
        <Button fx:id="btnEnregistrer" text="Enregistrer" onAction="#onEnregistrer"
                style="-fx-background-color: #28a745; -fx-text-fill: white; -fx-font-weight: bold; -fx-cursor: hand; -fx-padding: 8 24;"/>
    </HBox>

</VBox>
